<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hashtag â€” Documents</title>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
:root{
  --primary:#4d96ff;
  --bg:#fafafa;
  --card:#fff;
  --muted:#6b7280;
  --heart:#ff3b30;
  --icon-size:20px;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto;background:var(--bg);color:#111}
header{position:sticky;top:0;z-index:12;background:var(--card);padding:12px;border-bottom:1px solid #eef2f7;display:flex;align-items:center;justify-content:space-between;gap:12px}
.tag-header{flex:1}
.tag-row{display:flex;align-items:center;gap:12px;justify-content:space-between}
#tagTitle{font-weight:700;font-size:1.2rem;display:flex;align-items:center;gap:8px}

.hashtag-card{background:var(--card);padding:12px;border-radius:12px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 6px 18px rgba(14,28,63,0.06);margin-top:10px}
.hashtag-left{display:flex;flex-direction:column;gap:4px}
.hashtag-name{font-size:1.15rem;font-weight:700}
.hashtag-sub{color:var(--muted);font-size:0.95rem}
.tag-actions{display:flex;gap:8px;align-items:center}
.icon-btn{width:44px;height:44px;border-radius:10px;background:#f3f6ff;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none;padding:6px}
.icon-btn.save{background:var(--primary);color:white}
.icon-btn.small{width:40px;height:40px;border-radius:8px}
main{padding:16px;min-height:calc(100vh - 140px);overflow-y:auto}
.file-card{background:var(--card);border-radius:14px;padding:12px;margin-bottom:12px;display:flex;justify-content:space-between;gap:12px;box-shadow:0 6px 18px rgba(14,28,63,0.06);align-items:flex-start}
.file-info{display:flex;gap:12px;align-items:flex-start;min-width:0;flex:1;cursor:pointer}
.file-icon{width:48px;height:48px;border-radius:10px;background:#f1f7ff;display:flex;align-items:center;justify-content:center;color:var(--primary);flex-shrink:0}
.meta{flex:1;min-width:0}
.meta h3{margin:0;font-size:1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.uploader{display:flex;align-items:center;gap:8px;margin-top:8px;color:var(--primary);font-weight:600}
.uploader small{
  color: gray;
}
.uploader img{width:22px;height:22px;border-radius:50%;object-fit:cover;display:none}
.tags{display:flex;gap:8px;margin-top:8px;overflow:auto;padding-bottom:4px}
.tag-pill{background:#eef4ff;color:var(--primary);padding:6px 10px;border-radius:999px;font-size:12px;cursor:pointer;white-space:nowrap}
.actions{display:flex;flex-direction:column;gap:6px;align-items:center;margin-left:8px}
.actions button{background:none;border:none;cursor:pointer;padding:6px;border-radius:8px;display:flex;align-items:center;justify-content:center}
.actions i{width:var(--icon-size);height:var(--icon-size)}
.like-count{font-size:12px;color:var(--muted)}
.heart-outline svg{stroke:#666;fill:none}
.heart-filled svg{stroke:var(--heart);fill:var(--heart)}
.share-sheet{position:fixed;left:0;right:0;bottom:-100%;background:#fff;border-radius:12px 12px 0 0;padding:12px;box-shadow:0 -12px 40px rgba(0,0,0,0.12);transition:bottom .28s ease;z-index:60}
.share-sheet.show{bottom:0}
.share-row{display:flex;gap:18px;justify-content:center;padding:10px 0}
.small{font-size:13px;color:var(--muted)}
/* animations */
.icon-bounce{animation:iconPop .35s ease}
@keyframes iconPop{0%{transform:scale(1)}40%{transform:scale(1.25)}100%{transform:scale(1)}}
.tag-card-saved{background:rgba(77,150,255,0.06)}
@media (max-width:520px){.file-icon{width:44px;height:44px}.meta h3{font-size:0.98rem}}
.done{
color: blue;

}
</style>
</head>
<body>
<header>
  <div class="tag-header">
    <div class="tag-row">
      <div id="tagTitle"><i data-lucide="hash"></i></div>
     
    </div>

    <div class="hashtag-card tag-card" id="hashtagCard">
      <div class="hashtag-left">
        <div class="hashtag-name" id="headerTag">#tag</div>
        <div class="hashtag-sub" id="headerCount">0 files</div>
      </div>

      <div class="tag-actions" role="toolbar" aria-label="hashtag actions">
        <button id="tagSave" class="icon-btn" title="Save tag"><i data-lucide="bookmark"></i></button>
        <button id="tagShare" class="icon-btn" title="Share tag"><i data-lucide="share-2"></i></button>
      </div>
    </div>
  </div>

  <div style="width:44px"></div>
</header>

<main>
  <div id="listContainer">
    <p id="loadingText" class="small">Loading filesâ€¦</p>
  </div>
</main>

<div id="shareSheet" class="share-sheet" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <strong>Share</strong>
    <button id="btnCloseShare" style="background:none;border:none;cursor:pointer"><i data-lucide="x"></i></button>
  </div>
  <div class="share-row">
    <button id="btnShareWhats" style="background:none;border:none;cursor:pointer"><i data-lucide="message-circle"></i><div class="small">WhatsApp</div></button>
    <button id="btnShareTg" style="background:none;border:none;cursor:pointer"><i data-lucide="send"></i><div class="small">Telegram</div></button>
    <button id="btnShareCopy" style="background:none;border:none;cursor:pointer"><i data-lucide="copy"></i><div class="small">Copy</div></button>
  </div>
</div>
<script src="config.js"></script>
<script>
(() => {
  'use strict';


  const LIST_PATH = "list.json";

  // ---------- HELPERS ----------
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const safeIcons = () => { if (typeof lucide !== 'undefined' && lucide.createIcons) { try{ lucide.createIcons(); } catch(e){} } };

  function b64DecodeUnicode(str) {
    try {
      return decodeURIComponent(Array.prototype.map.call(atob(str), c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
    } catch (e) { return atob(str); }
  }

  async function ghGet(path) {
    const url = `https://api.github.com/repos/${G_NAME}/${REPO}/contents/${path}`;
    const res = await fetch(url, { headers: { Authorization: `token ${TOKEN}` }});
    if (!res.ok) throw res;
    return res.json();
  }

  async function ghPut(path, contentBase64, message, sha) {
    const url = `https://api.github.com/repos/${G_NAME}/${REPO}/contents/${path}`;
    const body = { message, content: contentBase64 };
    if (sha) body.sha = sha;
    const res = await fetch(url, {
      method: 'PUT',
      headers: { Authorization: `token ${TOKEN}`, 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    if (!res.ok) throw res;
    return res.json();
  }

  function normalizeTags(v) {
    if (!v) return [];
    if (Array.isArray(v)) return v;
    if (typeof v === 'string') return v.split(',').map(x => x.trim()).filter(Boolean);
    return [];
  }

  function escapeHtml(s) { return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function escapeAttr(s) { return (s || '').replace(/"/g, '&quot;'); }

  // ---------- STATE ----------
  let LIST = {};
  let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
  let savedTags = JSON.parse(localStorage.getItem('savedTags') || '[]');
  
  const login = JSON.parse(localStorage.getItem('login') || '{}');
  const loggedUser = login && login.username ? login.username : null;

  const urlTag = new URLSearchParams(location.search).get('tag') || '';
  let CURRENT_TAG = urlTag || '';

  // ---------- ELEMENTS ----------
  
  const headerTagEl = $('#headerTag');

  const headerCountEl = $('#headerCount');
  const listContainer = $('#listContainer');
  const loadingText = $('#loadingText');

  // Renamed tagBookmarkBtn to tagSaveBtn and removed tagPlusBtn
  const tagSaveBtn = $('#tagSave');
  const tagShareBtn = $('#tagShare');
  const hashtagCardEl = $('#hashtagCard');

  const shareSheet = $('#shareSheet');
  const btnCloseShare = $('#btnCloseShare');
  const btnShareWhats = $('#btnShareWhats');
  const btnShareTg = $('#btnShareTg');
  const btnShareCopy = $('#btnShareCopy');

  let currentSharePath = null;
  let likeLock = false;

  safeIcons();

  // ---------- LOAD list.json ----------
  async function loadList() {
    loadingText && (loadingText.textContent = 'Loading filesâ€¦');
    try {
      const res = await ghGet(LIST_PATH);
      LIST = JSON.parse(b64DecodeUnicode(res.content || btoa('{}'))) || {};
    } catch (err) {
      LIST = {};
      console.warn('Failed to load list.json', err);
    }
  }

  // ---------- RENDER FILTERED ----------
  function renderFiltered(tag) {
    CURRENT_TAG = (tag || '').trim();
    
    headerTagEl && (headerTagEl.textContent = '#' + CURRENT_TAG);

    const entries = Object.entries(LIST || {});
    const matched = entries.filter(([id, meta]) => {
      const tags = normalizeTags(meta.Hastags);
      return tags.includes(CURRENT_TAG);
    });

    
    headerCountEl && (headerCountEl.textContent = `${matched.length} files`);

    listContainer.innerHTML = '';
    if (matched.length === 0) {
      const p = document.createElement('p'); p.className = 'small'; p.textContent = 'No files for this hashtag';
      listContainer.appendChild(p);
      safeIcons();
      return;
    }

    matched.sort((a,b) => (b[1].Time || 0) - (a[1].Time || 0));

    for (const [id, meta] of matched) {
      const card = createFileCard(id, meta);
      listContainer.appendChild(card);
    }
    safeIcons();
  }

  // ---------- CREATE FILE CARD (same logic as home) ----------
  function createFileCard(id, meta) {
    const tags = normalizeTags(meta.Hastags);
    const uploader = (meta.Uploader || '').replace(/^@/,'');
    const likesArr = Array.isArray(meta.Likes) ? meta.Likes : (Array.isArray(meta.LikedBy) ? meta.LikedBy : []);
    const likeCount = likesArr.length;
    const userLiked = loggedUser ? likesArr.includes(loggedUser) : false;
    const isBookmarked = bookmarks.includes(id); // <--- File bookmark check

    const ext = (meta.Path||'').split('.').pop().toLowerCase();
    const iconName = (ext === 'pdf') ? 'file-text' : (ext.startsWith('ppt') ? 'presentation' : 'file');

    const art = document.createElement('article');
    art.className = 'file-card';
    art.innerHTML = `
      <div class="file-info" data-fileid="${escapeAttr(id)}">
        <div class="file-icon"><i data-lucide="${iconName}"></i></div>
        <div class="meta">
          <h3 class="file-name" title="${escapeHtml(meta.Name)}">${escapeHtml(meta.Name)}</h3>
          <div class="uploader" data-uploader="${encodeURIComponent(uploader)}">
            <div style="width:22px;height:22px;border-radius:50%;background:#eee"></div>
            <div style="margin-left:6px;color:var(--primary);font-weight:600">@${escapeHtml(uploader || meta.UploaderName || 'unknown')} <small> â€¢${timeAgo(meta.Time||0)}</small>
         </div>
          </div>
          <div class="tags">
            ${tags.map(t => `<span class="tag-pill" data-tag="${escapeAttr(t)}">#${escapeHtml(t)}</span>`).join('')}
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="share-btn" data-path="${escapeAttr(meta.Path)}" title="Share"><i data-lucide="share-2"></i></button>

        <button class="like-btn ${userLiked ? 'heart-filled' : 'heart-outline'}" data-id="${escapeAttr(id)}" title="Like">
          <i data-lucide="heart"></i>
        </button>
        <div class="like-count small">${likeCount}</div>

        <button class="bookmark-btn" data-id="${escapeAttr(id)}" title="Bookmark"><i data-lucide="${isBookmarked ? 'bookmark-x' : 'bookmark'}"></i></button>
      </div>
    `;
    attachCardHandlers(art, id, meta);
    return art;
  }

  // ---------- ATTACH HANDLERS ----------
  function attachCardHandlers(cardEl, id, meta) {
    const shareBtn = cardEl.querySelector('.share-btn');
    const likeBtn = cardEl.querySelector('.like-btn');
    const bmBtn = cardEl.querySelector('.bookmark-btn');
    const tagEls = cardEl.querySelectorAll('.tag-pill');
    const uploaderEl = cardEl.querySelector('.uploader');
    const left = cardEl.querySelector('.file-info');

    if (shareBtn) shareBtn.addEventListener('click', ev => { ev.stopPropagation(); openShareSheet(meta.Path); });
    if (likeBtn) likeBtn.addEventListener('click', async ev => { ev.stopPropagation(); await handleLikeClick(id, meta, likeBtn); });
    // Point 1: Bookmark icon in list card instantly changes/updates local storage
    if (bmBtn) bmBtn.addEventListener('click', ev => { ev.stopPropagation(); toggleBookmarkFile(id, bmBtn); });
    tagEls.forEach(t => t.addEventListener('click', ev => { ev.stopPropagation(); filterByTagInstant(t.dataset.tag); }));
    if (uploaderEl) uploaderEl.addEventListener('click', ev => { ev.stopPropagation(); const uname = decodeURIComponent(uploaderEl.dataset.uploader || ''); if (uname) location.href = `profile.html?user=${encodeURIComponent(uname)}`; });
    // 5. ðŸ“„ File Card Click (Redirect to PDF.html)
document.addEventListener("click", (e) => {
    const fileCard = e.target.closest(".file-card");
    if (fileCard && !e.target.closest(".actions")) {
        // à¤¯à¤¹ à¤¸à¥à¤¨à¤¿à¤¶à¥à¤šà¤¿à¤¤ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¤¿ à¤•à¥à¤²à¤¿à¤• 'actions' (Like/Bookmark/Share) à¤¬à¤Ÿà¤¨ à¤ªà¤° à¤¨à¤¹à¥€à¤‚ à¤¹à¥à¤† à¤¹à¥ˆ
        
        // à¤‰à¤¸ à¤«à¤¾à¤‡à¤² à¤•à¤¾à¤°à¥à¤¡ à¤•à¤¾ ID à¤–à¥‹à¤œà¥‡à¤‚ à¤œà¤¿à¤¸à¤•à¥‡ à¤¡à¥‡à¤Ÿà¤¾ à¤•à¥€ à¤¹à¤®à¥‡à¤‚ à¤œà¤¼à¤°à¥‚à¤°à¤¤ à¤¹à¥ˆ
        // à¤šà¥‚à¤‚à¤•à¤¿ à¤¹à¤®à¤¾à¤°à¥‡ à¤ªà¤¾à¤¸ à¤•à¥‡à¤µà¤² ID à¤¹à¥€ à¤¸à¥€à¤§à¥‡ à¤•à¤¾à¤°à¥à¤¡ à¤®à¥‡à¤‚ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ, 
        // à¤¹à¤® à¤ªà¤¹à¤²à¥‡ à¤¶à¥‡à¤¯à¤° à¤¬à¤Ÿà¤¨ à¤•à¥‡ 'data-path' à¤•à¥‹ à¤–à¥‹à¤œà¤¨à¥‡ à¤•à¥€ à¤•à¥‹à¤¶à¤¿à¤¶ à¤•à¤°à¥‡à¤‚à¤—à¥‡
        const shareBtn = fileCard.querySelector('.share-btn');
        const filePath = shareBtn ? shareBtn.dataset.path : null;

        if (filePath) {
            // URL à¤•à¥‹ encode à¤•à¤°à¤•à¥‡ 'path' à¤ªà¥ˆà¤°à¤¾à¤®à¥€à¤Ÿà¤° à¤•à¥‡ à¤¸à¤¾à¤¥ à¤°à¥€à¤¡à¤¾à¤¯à¤°à¥‡à¤•à¥à¤Ÿ à¤•à¤°à¥‡à¤‚
            window.location.href = `pdf.html?path=${encodeURIComponent(filePath)}`;
        }
    }
});
}


  // ---------- BOOKMARK FILE (instant) ----------
  function toggleBookmarkFile(id, btn) {
    const idx = bookmarks.indexOf(id);
    const isBookmarked = idx !== -1;
    if (isBookmarked){ bookmarks.splice(idx,1) 
    ;} else bookmarks.push(id);
    
    localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
    
    // Instant UI update
    const icon = btn.querySelector('i');
    if (icon) {
      // isBookmarked = old state, !isBookmarked = new state
      icon.setAttribute('data-lucide', !isBookmarked ? 'bookmark-x' : 'bookmark'); 
      safeIcons();
      // small visual bounce
      btn.classList.add('icon-bounce');
      setTimeout(()=>btn.classList.remove('icon-bounce'), 350);
    }
  }

  // ---------- LIKE (instant UI + async persist) ----------
  let writeLock = false;
  async function handleLikeClick(id, meta, btn) {
    if (!loggedUser) { if (confirm('Login required to like. Go to login?')) location.href='login.html'; return; }

    const arr = Array.isArray(meta.Likes) ? meta.Likes.slice() : (Array.isArray(meta.LikedBy) ? meta.LikedBy.slice() : []);
    const idx = arr.indexOf(loggedUser);
    const willLike = idx === -1;
    if (willLike) arr.push(loggedUser); else arr.splice(idx,1);

    // instant UI
    btn.classList.toggle('heart-filled', willLike);
    btn.classList.toggle('heart-outline', !willLike);
    const countEl = btn.parentElement.querySelector('.like-count');
    if (countEl) countEl.textContent = arr.length;
    btn.classList.add('icon-bounce'); setTimeout(()=>btn.classList.remove('icon-bounce'), 350);

    // persist in background
    try { await persistLikesToGithub(id, arr); meta.Likes = arr; LIST[id] = meta; } catch (e) { console.error('persist like failed', e); }
  }

  async function persistLikesToGithub(id, arr) {
    if (writeLock) return;
    writeLock = true;
    try {
      const r = await ghGet(LIST_PATH);
      const listObj = JSON.parse(b64DecodeUnicode(r.content || btoa('{}')));
      if (!listObj[id]) listObj[id] = LIST[id] || {};
      listObj[id].Likes = arr;
      const payload = btoa(unescape(encodeURIComponent(JSON.stringify(listObj, null, 2))));
      await ghPut(LIST_PATH, payload, `Update likes for ${id}`, r.sha);
      LIST = listObj;
    } finally { writeLock = false; }
  }

  // ---------- SHARE SHEET ----------
  function openShareSheet(path) {
    currentSharePath = path;
    if (shareSheet) shareSheet.classList.add('show');
  }
  function closeShareSheet() {
    currentSharePath = null;
    if (shareSheet) shareSheet.classList.remove('show');
  }
  if (btnCloseShare) btnCloseShare.addEventListener('click', closeShareSheet);
  // Note: Share logic for the file card still uses pdf.html
  if (btnShareWhats) btnShareWhats.addEventListener('click', ()=> { if(!currentSharePath) return; window.open(`https://wa.me/?text=${encodeURIComponent(location.origin + '/pdf.html?file=' + currentSharePath)}`,'_blank'); closeShareSheet(); });
  if (btnShareTg) btnShareTg.addEventListener('click', ()=> { if(!currentSharePath) return; window.open(`https://t.me/share/url?url=${encodeURIComponent(location.origin + '/pdf.html?file=' + currentSharePath)}`,'_blank'); closeShareSheet(); });
  if (btnShareCopy) btnShareCopy.addEventListener('click', ()=> { if(!currentSharePath) return; navigator.clipboard.writeText(location.origin + '/pdf.html?file=' + currentSharePath).then(()=>{ alert('Link copied'); closeShareSheet(); }); });

  // ---------- HEADER TAG ACTIONS (Only Save/Share remain) ----------
  
  if (tagShareBtn) {
    tagShareBtn.addEventListener('click', () => {
      const url = `${location.origin}/hashtags.html?tag=${encodeURIComponent(CURRENT_TAG)}`;
      // Reuse share sheet: we set currentSharePath to a hashtag URL placeholder
      currentSharePath = `HASHTAG::${url}`;
      if (shareSheet) shareSheet.classList.add('show');
      // override share handlers to use hashtag url when copying/sharing
      const shareUrl = url;
      const wh = () => { window.open(`https://wa.me/?text=${encodeURIComponent(shareUrl)}`,'_blank'); closeShareSheet(); };
      const tg = () => { window.open(`https://t.me/share/url?url=${encodeURIComponent(shareUrl)}`,'_blank'); closeShareSheet(); };
      const cp = () => { navigator.clipboard.writeText(shareUrl).then(()=> { alert('Hashtag link copied'); closeShareSheet(); }); };

      if (btnShareWhats) { btnShareWhats.onclick = wh; }
      if (btnShareTg) { btnShareTg.onclick = tg; }
      if (btnShareCopy) { btnShareCopy.onclick = cp; }
    });
  }
  const t = CURRENT_TAG;
const idx = savedTags.indexOf(t);
      const wasSaved = idx !== -1;
      tagSaveBtn.setAttribute('class', wasSaved ? 'done' : 'icon-btn'); 
  // Point 2 & 3: Rename tagBookmarkBtn to Btn and update its logic
  if (tagSaveBtn) {
    tagSaveBtn.addEventListener('click', () => {
    
      const t = CURRENT_TAG;  if (!t) return;
      const idx = savedTags.indexOf(t);
      const wasSaved = idx !== -1;
      
      if (wasSaved) {savedTags.splice(idx,1)

      }
      else savedTags.push(t);
      localStorage.setItem('savedTags', JSON.stringify(savedTags));
    
      // Instant UI update for hashtag card
      const isSaved = !wasSaved;
      const icon = tagSaveBtn.querySelector('i');
      
        
        // wasSaved = old state, isSaved = new state
      
   tagSaveBtn.setAttribute('class', isSaved ? 'done' : 'icon-btn'); 
        safeIcons(); 
      
      if (hashtagCardEl) {
        if (isSaved) hashtagCardEl.classList.add('savehas'); else hashtagCardEl.classList.remove('tag-card-saved');
      }
      tagSaveBtn.classList.add('icon-bounce'); 
      setTimeout(()=>tagSaveBtn.classList.remove('icon-bounce'), 350);
    });
  }

  // ---------- INSTANT FILTER (Option 1) ----------
  function filterByTagInstant(tag) {
    if (!tag) return;
    renderFiltered(tag);
    const t = tag;
const idx = savedTags.indexOf(t);
      const wasSaved = idx !== -1;
      tagSaveBtn.setAttribute('class', wasSaved ? 'done' : 'icon-btn'); 
    const u = new URL(location.href); u.searchParams.set('tag', tag); history.replaceState({}, '', u);
  }
  window.filterByTagInstant = filterByTagInstant;

  // ---------- INIT ----------
  (async function init() {
    safeIcons();
    await loadList();
    if (!CURRENT_TAG) {
      
      headerTagEl && (headerTagEl.textContent = '#');
      headerCountEl && (headerCountEl.textContent = '0 files');
      listContainer.innerHTML = '<p class="small">No tag selected. Go to home and click a hashtag.</p>';
      safeIcons();
        setTimeout(() => {
               location.href = "home.html"
            },1000 )
      return;
    }
    
    // Update initial state for the new tagSaveBtn (Point 1: Hashtag already saved in local storage)
    if (savedTags.includes(CURRENT_TAG)) {
if (tagSaveBtn) { 
        const ik = tagSaveBtn.querySelector('i'); 
        if (ik) ik.setAttribute('data-lucide','bookmark-x'); // <--- 'bookmark-x' (Remove icon) if already saved
      }
      if (hashtagCardEl) hashtagCardEl.classList.add('tag-card-saved');
      safeIcons();
    }
    
    renderFiltered(CURRENT_TAG);
  })();
function timeAgo(ts){
  if(!ts) return '';
  const d = Date.now() - ts;
  const mins = Math.floor(d/60000);
  if(mins < 1) return 'Just now';
  if(mins < 60) return `${mins} minute${mins>1?'s':''} ago`;
  const hrs = Math.floor(mins/60);
  if(hrs < 24) return `${hrs} hour${hrs>1?'s':''} ago`;
  const days = Math.floor(hrs/24);
  return `${days} day${days>1?'s':''} ago`;
}
})();
</script>
</body>
</html>